<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <style>
      @page {
        size: A4 landscape;
        margin: 0;
      }
      html, body {
        height: 100%;
        margin: 0;
      }
      body {
        font-family: 'Helvetica', 'Arial', sans-serif;
        color: #333;
        line-height: 1.1;
        font-size: 11px;
        display: flex;
        flex-direction: column;
        padding: 0.6cm; /* Margem interna da folha */
        box-sizing: border-box;
        transform: scale(0.98); /* Reduz um pouco o conteúdo para evitar cortes */
        transform-origin: top left;
      }

      /* Header Fixo */
      .header-container {
        display: table;
        width: 100%;
        background: #f8fafc;
        padding: 10px 15px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        flex-shrink: 0;
        margin-bottom: 10px;
      }
      .logo-section { display: table-cell; vertical-align: middle; width: 15%; }
      .client-highlight { 
        display: table-cell; 
        vertical-align: middle; 
        width: 55%; 
        padding-left: 20px;
        border-left: 2px solid #2563eb;
      }
      .date-section { display: table-cell; vertical-align: middle; text-align: right; width: 30%; }

      .client-name { margin: 0; font-size: 18px; color: #1e293b; font-weight: 900; text-transform: uppercase; }
      .order-subtitle { font-size: 11px; color: #2563eb; font-weight: bold; }

      /* ÁREA DO LAYOUT - OCUPA O RESTO DO ESPAÇO */
      .layout-main {
        width: 100%;
        text-align: center;
        border: 1px dashed #cbd5e1;
        border-radius: 12px;
        background: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        height: 520px;
      }
      
      .layout-img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain; 
        image-rendering: auto; 
      }

      /* Footer Técnico Fixo */
      .specs-footer {
        display: table;
        width: 100%;
        background: #f1f5f9;
        padding: 10px;
        border-radius: 12px;
        flex-shrink: 0;
        margin-top: 10px;
      }

      .grid-column { 
        display: table-cell; 
        width: 1%; /* Força a coluna a encolher até o limite do conteúdo (fit-content) */
        white-space: nowrap; /* Garante que as caixinhas não quebrem linha antes do necessário */
        vertical-align: top; 
        padding-right: 15px; 
      }

      .total-column { 
        display: table-cell; 
        min-width: 10%; 
        vertical-align: top; 
        text-align: center; 
        border-left: 1px solid #cbd5e1; 
        border-right: 1px solid #cbd5e1; 
      }

      .specs-column { 
        display: table-cell; 
        /* Sem largura definida, ela herda todo o espaço que sobrou (flexível) */
        vertical-align: top; 
        padding-left: 15px; 
      }

      .section-label { font-size: 8px; font-weight: 900; color: #64748b; text-transform: uppercase; margin-bottom: 3px; display: block; }
      .spec-text { font-size: 10px; font-weight: bold; color: #1e293b; margin-bottom: 4px; display: block; }

      /* Estilo das caixinhas de tamanho */
      .grid-box {
        display: inline-block;
        background: #fff;
        border: 1px solid #e2e8f0;
        padding: 2px 5px;
        border-radius: 4px;
        text-align: center;
        min-width: 32px;
      }
      .grid-label { display: block; font-size: 12px; font-weight: bold; color: #000000; }
      .grid-value { font-size: 15px; font-weight: 900; color: #2563eb; }
      
      .total-badge {
        background: #2563eb;
        color: #fff;
        padding: 8px;
        border-radius: 10px;
        display: inline-block;
      }
      
      .footer-note { text-align: right; font-size: 7px; color: #94a3b8; margin-top: 4px; }
    </style>
  </head>
  <body>
    <div class="header-container">
      <div class="logo-section">
        {% if logo_url %}
          <img src="{{ logo_url }}" style="max-height: 40px; transform: scale(2.7) translateX(15px)" />
          {% else %}
          <strong style="color: #2563eb; font-size: 16px">PRINT COLLOR</strong>
        {% endif %}
      </div>
      <div class="client-highlight">
        <h1 class="client-name">{{ pedido.cliente.nome }}</h1>
        <div class="order-subtitle">{{ pedido.nome_descricao }}</div>
      </div>
      <div class="date-section">
        <div style="font-size: 12px; font-weight: bold">PEDIDO #{{ pedido.id }}</div>
        <div style="font-size: 12px; color: #64748b">
          Emissão: {{ pedido.data_criacao|date:"d/m/Y" }} | <strong>ENTREGA: {{ pedido.data_entrega|date:"d/m/Y" }}</strong>
        </div>
      </div>
    </div>

    <div class="layout-main">
      {% if pedido.layout %}
      <img src="{{ layout_url }}" class="layout-img" />
      {% else %}
      <div style="color: #cbd5e1; font-weight: bold">VISUALIZAÇÃO DO LAYOUT INDISPONÍVEL</div>
      {% endif %}
    </div>
    
    <div class="specs-footer">
      <div class="grid-column">
        <span class="section-label">Grade de Quantidades</span>
        
        <div style="margin-bottom: 4px;">
          {% for tamanho, qtd in pedido.detalhes_tamanho.items %}
            {% with t=tamanho|lower %}
            {% if "bl" not in t and "a" not in t and t.0 not in "0123456789" %}
                <div class="grid-box"><span class="grid-label">{{ tamanho|upper }}</span><span class="grid-value">{{ qtd }}</span></div>
              {% endif %}
              {% endwith %}
              {% endfor %}
            </div>

            <div style="margin-bottom: 4px;">
              {% for tamanho, qtd in pedido.detalhes_tamanho.items %}
            {% if "bl" in tamanho|lower %}
            <div class="grid-box" style="border-color: #fbcfe8;"><span class="grid-label">{{ tamanho|upper }}</span><span class="grid-value">{{ qtd }}</span></div>
            {% endif %}
          {% endfor %}
        </div>
        
        <div style="margin-bottom: 4px;">
          {% for tamanho, qtd in pedido.detalhes_tamanho.items %}
          {% with t=tamanho|lower %}
              {% if "bl" not in t %}
                {% if "a" in t or "anos" in t %}
                {% if t.0 in "0123456789" %}
                      <div class="grid-box" style="border-color: #fef3c7;"><span class="grid-label">{{ tamanho|upper }}</span><span class="grid-value">{{ qtd }}</span></div>
                  {% endif %}
                  {% endif %}
              {% endif %}
              {% endwith %}
          {% endfor %}
        </div>

        <div>
          {% for tamanho, qtd in pedido.detalhes_tamanho.items %}
          {% with t=tamanho|lower %}
              {% if t.0 in "3456" and "a" not in t and "bl" not in t %}
                <div class="grid-box" style="border-color: #cbd5e1;"><span class="grid-label">{{ tamanho|upper }}</span><span class="grid-value">{{ qtd }}</span></div>
                {% endif %}
            {% endwith %}
            {% endfor %}
          </div>
      </div>
      
      <div class="total-column">
        <span class="section-label">Total</span>
        <div class="total-badge">
          <div style="font-size: 18px; font-weight: 900">{{ total }}</div>
          <div style="font-size: 7px; font-weight: bold; opacity: 0.8">UNIDADES</div>
        </div>
      </div>

      <div class="specs-column">
        <span class="section-label">Informações</span>
        <span style="font-size: 12px; color: #64748b;">OBSERVAÇÃO:</span>
        <span class="spec-text" style="font-size: 9px; line-height: 1;">{{ pedido.descricao|upper }}</span>
        <span style="font-size: 12px; color: #64748b;">MATERIAL:</span>
        <span class="spec-text" style="font-size: 9px; line-height: 1;">{{ pedido.material|upper }}</span>
        <span style="font-size: 12px; color: #64748b;">APLICAÇÃO:</span>
        <span class="spec-text" style="font-size: 9px; line-height: 1;">{{ pedido.aplicacao_arte|upper }}</span>
      </div>
    </div>
    
    <div class="footer-note">
      Print Collor - Gerado em {{ now|date:"d/m/Y H:i" }}
    </div>
  </body>
  </html>